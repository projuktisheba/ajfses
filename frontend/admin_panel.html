<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">


    <title>AJ FIRE SOLUTIONS LTD - A TRUSTED FIRE & SAFETY SUPPLIER COMPANY</title>

    <link href="img/favicon.ico" rel="icon">
    <!-- Fonts (Same as Public Site) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Roboto:wght@500;700&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Tailwind CSS (for rapid, clean styling) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuration to match specific brand colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        heading: ['Roboto', 'sans-serif'],
                    },
                    colors: {
                        primary: '#FF3E41',
                        secondary: '#51CFED',
                        light: '#F8F2F0',
                        dark: '#060315',
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Sidebar Transition */
        .sidebar {
            transition: transform 0.3s ease-in-out;
        }

        /* Table Row Hover */
        .table-row-hover:hover td {
            background-color: #f8fafc;
        }

        /* Hide logic for SPA sections */
        .section-view {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .section-view.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Sidebar active state indicator */
        .nav-item.active {
            background-color: #1f2937;
            /* gray-800 */
            color: #ffffff;
            border-left-color: #0d6efd;
        }

        .nav-item {
            border-left-width: 4px;
            border-left-color: transparent;
        }
    </style>
    <!-- Load auth check BEFORE anything else -->
    <script src="js/auth.js"></script>
    <script>
        if (!isAuthenticated()) {
            window.location.replace("signin.html");
        }
    </script>
</head>

<body class="bg-gray-50 text-gray-800 font-sans antialiased">

    <div class="min-h-screen flex flex-col flex-auto flex-shrink-0 antialiased bg-gray-50 text-gray-800">

        <!-- Header / Top Navigation (Updated Color Scheme) -->
        <div
            class="fixed w-full flex items-center justify-between h-16 text-gray-800 z-20 bg-white shadow-md px-6 border-t-4 border-primary">
            <div class="flex items-center gap-4">
                <button id="mobile-menu-btn"
                    class="lg:hidden text-gray-600 hover:text-primary focus:outline-none transition">
                    <i class="fa fa-bars text-2xl"></i>
                </button>
                <div class="flex items-center gap-2 font-heading font-bold text-xl tracking-wider text-primary">
                    <i class="fa fa-shield-alt"></i>
                    <span>AJFSES ADMIN</span>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <!-- Notifications -->
                <!-- <button class="relative p-2 text-gray-600 hover:text-primary transition">
                    <i class="fa fa-bell"></i>
                    <span class="absolute top-1 right-1 h-2 w-2 bg-red-500 rounded-full border border-white"></span>
                </button> -->

                <!-- Profile Dropdown (Updated) -->
                <div class="relative ml-2">
                    <button onclick="toggleProfileMenu()"
                        class="flex items-center gap-2 focus:outline-none hover:bg-gray-100 p-2 rounded-lg transition">
                        <img src="https://ui-avatars.com/api/?name=Admin+User&background=0d6efd&color=fff" alt="Admin"
                            class="h-8 w-8 rounded-full border-2 border-gray-100 shadow-sm">
                        <span id="user-name"
                            class="hidden md:block font-medium text-sm text-gray-700">Administrator</span>
                        <i class="fa fa-chevron-down text-xs hidden md:block text-gray-500"></i>
                    </button>

                    <!-- Dropdown Menu -->
                    <div id="profile-menu"
                        class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 ring-1 ring-black ring-opacity-5 origin-top-right">
                        <div class="px-4 py-3 border-b border-gray-100">
                            <p class="text-sm">Signed in as</p>
                            <p id="user-email" class="text-sm font-bold text-gray-900 truncate">admin@ajfses.com</p>
                        </div>
                        <a onclick="openProfileViewModal()"
                            class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"><i
                                class="fa fa-user mr-2 text-gray-400"></i> Your Profile</a>
                        <a onclick="openResetPasswordModal()"
                            class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"><i
                                class="fa fa-key mr-2 text-gray-400"></i> Change Password</a>

                        <!-- <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"><i
                                class="fa fa-cog mr-2 text-gray-400"></i> Settings</a>
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"><i
                                class="fa fa-list mr-2 text-gray-400"></i> Activity Log</a> -->
                        <div class="border-t border-gray-100 my-1"></div>
                        <button type="button" onclick="signout()"
                            class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100"><i
                                class="fa fa-sign-out-alt mr-2"></i> Sign out</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Profile view modal -->
        <div id="profileViewModal" class="fixed inset-0 z-50 hidden overflow-y-auto"
            aria-labelledby="profileViewModalLabel" role="dialog" aria-modal="true">

            <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <div class="fixed inset-0 bg-gray-900 bg-opacity-70 transition-opacity"
                    onclick="closeProfileViewModal()" aria-hidden="true"></div>

                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

                <div
                    class="inline-block align-bottom bg-white rounded-2xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full">

                    <div class="bg-white px-6 pt-5 pb-3 flex justify-between items-center border-b border-gray-100">
                        <h3 class="text-xl font-semibold text-gray-800" id="profileViewModalLabel">
                            Profile Information
                        </h3>
                        <button type="button" class="text-gray-400 hover:text-gray-700 p-1 rounded-full"
                            onclick="closeProfileViewModal()">
                            <i class="fa fa-times text-lg"></i>
                        </button>
                    </div>

                    <div class="bg-white px-6 pt-4 pb-6">
                        <div class="w-full space-y-5">
                            <div class="flex items-center justify-between border-b border-gray-100 pb-3">
                                <div class="flex items-center space-x-4">
                                    <img id="viewProfileImage" src="img/user.webp" alt="Profile Picture"
                                        class="h-16 w-16 object-cover rounded-full shadow-md">
                                    <div class="flex flex-col">
                                        <p id="viewProfileName" class="text-lg font-bold text-gray-900">ajfses Admin</p>
                                        <p id="viewProfileEmail" class="text-sm text-gray-500">
                                            ajfiresolutions@hotmail.com</p>
                                    </div>
                                </div>

                            </div>

                            <div class="grid grid-cols-2 gap-x-4 gap-y-3">
                                <div
                                    class="p-3 border border-gray-100 rounded-lg shadow-md hover:shadow-lg transition duration-200 bg-white">
                                    <span class="text-xs font-semibold uppercase tracking-wider text-gray-500">Full
                                        Name</span>
                                    <div class="flex items-center mt-1 space-x-2">
                                        <p class="text-gray-900 text-sm font-medium" id="viewProfileNameDisplay">ajfses
                                            Admin</p>
                                        <span id="viewProfileStatus"
                                            class="inline-flex items-center rounded-full bg-green-100 px-2 py-0.5 text-xs font-medium text-green-800">Active</span>
                                    </div>
                                </div>

                                <div
                                    class="p-3 border border-gray-100 rounded-lg shadow-md hover:shadow-lg transition duration-200 bg-white">
                                    <span
                                        class="text-xs font-semibold uppercase tracking-wider text-gray-500">Role</span>
                                    <p class="text-gray-900 text-sm font-medium mt-1" id="viewProfileRoleDisplay">Admin
                                    </p>
                                </div>

                                <div
                                    class="p-3 border border-gray-100 rounded-lg shadow-md hover:shadow-lg transition duration-200 bg-white">
                                    <span
                                        class="text-xs font-semibold uppercase tracking-wider text-gray-500">Mobile</span>
                                    <p class="text-gray-900 text-sm font-medium mt-1" id="viewProfileMobile">
                                        +09611-699282</p>
                                </div>

                                <div
                                    class="p-3 border border-gray-100 rounded-lg shadow-md hover:shadow-lg transition duration-200 bg-white">
                                    <span class="text-xs font-semibold uppercase tracking-wider text-gray-500">Joining
                                        Date</span>
                                    <p class="text-gray-900 text-sm font-medium mt-1" id="viewProfileJoiningDate">Dec
                                        03, 2025</p>
                                </div>

                                <div
                                    class="p-3 border border-gray-100 rounded-lg shadow-md hover:shadow-lg transition duration-200 bg-white">
                                    <span class="text-xs font-semibold uppercase tracking-wider text-gray-500">Created
                                        At</span>
                                    <p class="text-gray-900 text-sm font-medium mt-1" id="viewProfileCreatedAt">Dec 03,
                                        2025</p>
                                </div>

                                <div
                                    class="p-3 border border-gray-100 rounded-lg shadow-md hover:shadow-lg transition duration-200 bg-white">
                                    <span class="text-xs font-semibold uppercase tracking-wider text-gray-500">Last
                                        Updated</span>
                                    <p class="text-gray-900 text-sm font-medium mt-1" id="viewProfileUpdatedAt">Dec 14,
                                        2025</p>
                                </div>

                            </div>

                            <div class="mt-4 pt-3 border-t border-gray-100"> <span
                                    class="text-sm font-semibold text-gray-700 block mb-1">Full Address</span>
                                <div
                                    class="p-3 border border-gray-100 rounded-lg shadow-md bg-white hover:shadow-lg transition duration-200">
                                    <p id="viewProfileAddress" class="text-gray-700 text-sm">
                                        SRA Centre (6th Floor), Pllibidyut Bus Stand, Ashulia, Savar, Dhaka, Bangladesh
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <!-- Reset password modal -->
        <div id="resetPasswordModal" class="fixed inset-0 z-50 hidden overflow-y-auto"
            aria-labelledby="resetPasswordModalLabel" aria-modal="true" role="dialog">

            <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
                    onclick="closeResetPasswordModal()" aria-hidden="true"></div>

                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

                <div
                    class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full">

                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6">
                        <div class="sm:flex sm:items-start">
                            <div class="w-full">

                                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4"
                                    id="resetPasswordModalLabel">
                                    <i class="fa fa-key text-primary mr-2"></i>Reset Admin Password
                                </h3>

                                <form id="resetPasswordForm">
                                    <div class="mb-4">
                                        <label for="newPassword" class="block text-sm font-medium text-gray-700">New
                                            Password
                                            <span class="text-red-500">*</span></label>
                                        <div class="relative">
                                            <input type="password"
                                                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm pr-10"
                                                id="newPassword" required minlength="6">
                                            <button type="button"
                                                class="absolute inset-y-0 right-0 flex items-center px-3 text-gray-500 hover:text-gray-800"
                                                onclick="togglePasswordVisibility('newPassword', 'toggleNewPasswordIcon')"
                                                aria-label="Toggle password visibility">
                                                <i id="toggleNewPasswordIcon" class="fa fa-eye-slash"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label for="confirmPassword"
                                            class="block text-sm font-medium text-gray-700">Confirm New
                                            Password <span class="text-red-500">*</span></label>
                                        <div class="relative">
                                            <input type="password"
                                                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm pr-10"
                                                id="confirmPassword" required>
                                            <button type="button"
                                                class="absolute inset-y-0 right-0 flex items-center px-3 text-gray-500 hover:text-gray-800"
                                                onclick="togglePasswordVisibility('confirmPassword', 'toggleConfirmPasswordIcon')"
                                                aria-label="Toggle password visibility">
                                                <i id="toggleConfirmPasswordIcon" class="fa fa-eye-slash"></i>
                                            </button>
                                        </div>
                                        <div class="text-red-500 text-xs mt-1 hidden" id="passwordMatchError">
                                            Passwords do not match.
                                        </div>
                                    </div>

                                    <div id="resetPasswordAlert" class="hidden mt-4 p-3 rounded-md text-sm"
                                        role="alert"></div>
                                </form>

                            </div>
                        </div>
                    </div>

                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="button" onclick="handleResetPassword()" id="btnSavePassword"
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary text-base font-medium text-white hover:bg-red-600 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">
                            <span id="resetPasswordSpinner" class="fa fa-spinner fa-spin hidden me-2"></span>
                            <span id="btnSavePasswordText">Save New Password</span>
                        </button>

                        <button type="button" onclick="closeResetPasswordModal()"
                            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div id="sidebar"
            class="sidebar fixed flex flex-col top-16 left-0 w-64 bg-slate-900 h-full border-r border-gray-800 z-10 transform -translate-x-full lg:translate-x-0">
            <div class="overflow-y-auto overflow-x-hidden flex-grow">
                <ul class="flex flex-col py-4 space-y-1">
                    <li class="px-5">
                        <div class="flex flex-row items-center h-8">
                            <div class="text-sm font-light tracking-wide text-gray-400">Menu</div>
                        </div>
                    </li>

                    <!-- Inquiries / Quotes -->
                    <li>
                        <a href="#" onclick="showSection('inquiries', this)"
                            class="active nav-item relative flex flex-row items-center h-11 focus:outline-none hover:bg-gray-800 text-gray-300 hover:text-white pr-6 cursor-pointer transition">
                            <span class="inline-flex justify-center items-center ml-4">
                                <i class="fa fa-envelope-open-text"></i>
                            </span>
                            <span class="ml-2 text-sm tracking-wide truncate">Inquiries</span>
                        </a>
                    </li>

                    <!-- Team Members -->
                    <li>
                        <a href="#" onclick="showSection('team-members', this)"
                            class="nav-item relative flex flex-row items-center h-11 focus:outline-none hover:bg-gray-800 text-gray-300 hover:text-white pr-6 cursor-pointer transition">
                            <span class="inline-flex justify-center items-center ml-4">
                                <i class="fa-solid fa-users"></i>
                            </span>
                            <span class="ml-2 text-sm tracking-wide truncate">Team Members</span>
                        </a>
                    </li>
                    <!-- Clients -->
                    <li>
                        <a href="#" onclick="showSection('clients', this)"
                            class="nav-item relative flex flex-row items-center h-11 focus:outline-none hover:bg-gray-800 text-gray-300 hover:text-white pr-6 cursor-pointer transition">
                            <span class="inline-flex justify-center items-center ml-4">
                                <i class="fa-solid fa-address-book"></i>
                            </span>
                            <span class="ml-2 text-sm tracking-wide truncate">Clients</span>
                        </a>
                    </li>
                    <!-- Photo Gallery -->
                    <li>
                        <a href="#" onclick="showSection('photo-gallery', this)"
                            class="nav-item relative flex flex-row items-center h-11 focus:outline-none hover:bg-gray-800 text-gray-300 hover:text-white pr-6 cursor-pointer transition">
                            <span class="inline-flex justify-center items-center ml-4">
                                <i class="fa-solid fa-photo-film"></i>
                            </span>
                            <span class="ml-2 text-sm tracking-wide truncate">Photo Gallery</span>
                        </a>
                    </li>

                    <li class="px-5 mt-4">
                        <div class="flex flex-row items-center h-8">
                            <div class="text-sm font-light tracking-wide text-gray-400">Others</div>
                        </div>
                    </li>
                    <li>
                        <a href="index.html"
                            class="nav-item relative flex flex-row items-center h-11 focus:outline-none hover:bg-gray-800 text-gray-300 hover:text-white pr-6 cursor-pointer transition">
                            <span class="inline-flex justify-center items-center ml-4">
                                <i class="fa fa-globe"></i>
                            </span>
                            <span class="ml-2 text-sm tracking-wide truncate">Visit Website</span>
                        </a>
                    </li>
                    <li>
                        <button type="button" onclick="signout()"
                            class="nav-item relative flex flex-row items-center h-11 focus:outline-none hover:bg-gray-800 text-gray-300 hover:text-white pr-6 cursor-pointer transition">
                            <span class="inline-flex justify-center items-center ml-4">
                                <i class="fa fa-sign-out-alt"></i>
                            </span>
                            <span class="ml-2 text-sm tracking-wide truncate">Logout</span>
                        </button>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Main Content Wrapper -->
        <div class="h-full ml-0 lg:ml-64 mt-16 p-6 transition-all duration-300">

            <!-- Global Date Header -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                <div>
                    <h2 id="page-title" class="text-2xl font-bold font-heading text-gray-800">Inquiry Management</h2>
                    <p id="page-desc" class="text-sm text-gray-500">Review and manage recent quote requests.
                    </p>
                </div>
                <div
                    class="mt-4 md:mt-0 bg-white shadow-sm px-4 py-2 rounded-lg border border-gray-200 text-sm text-gray-600 font-medium">
                    <i class="far fa-calendar-alt mr-2 text-primary"></i> <span id="current-date"></span>
                </div>
            </div>

            <!-- =========================
                 INQUIRIES VIEW 
                 ========================= -->
            <div id="inquiries-section" class="section-view active">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Card 1 -->
                    <div
                        class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-blue-500 hover:shadow-md transition">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p class="text-sm text-gray-500 font-medium uppercase">Total Inquiries</p>
                                <h3 id="total-inquiries" class="text-2xl font-bold text-gray-800">0</h3>
                            </div>
                            <div class="bg-blue-100 p-3 rounded-full text-blue-600">
                                <i class="fa fa-users text-xl"></i>
                            </div>
                        </div>
                        <div class="text-xs text-blue-500 font-medium">
                            <i class="fa fa-arrow-down"></i> Total incoming queries
                        </div>
                    </div>

                    <!-- Card 2 -->
                    <div
                        class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-yellow-500 hover:shadow-md transition">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p class="text-sm text-gray-500 font-medium uppercase">Pending Inquiries</p>
                                <h3 id="pending-inquiries" class="text-2xl font-bold text-gray-800">0</h3>
                            </div>
                            <div class="bg-yellow-100 p-3 rounded-full text-yellow-600">
                                <i class="fa fa-clock text-xl"></i>
                            </div>
                        </div>
                        <div class="text-xs text-yellow-500 font-medium">
                            <i class="fa fa-info-circle"></i> Requires attention
                        </div>
                    </div>

                    <!-- Card 3 -->
                    <div
                        class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-green-500 hover:shadow-md transition">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p class="text-sm text-gray-500 font-medium uppercase">Resolved Inquiries</p>
                                <h3 id="resolved-inquiries" class="text-2xl font-bold text-gray-800">0</h3>
                            </div>
                            <div class="bg-green-100 p-3 rounded-full text-green-600">
                                <i class="fa fa-check-circle text-xl"></i>
                            </div>
                        </div>
                        <div class="text-xs text-green-500 font-medium">
                            <i class="fa-solid fa-circle-check"></i> Inquiries resolved successfully
                        </div>
                    </div>
                </div>

                <!-- Recent Inquiries Table -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 mb-8">
                    <div
                        class="p-5 border-b border-gray-200 flex flex-col md:flex-row justify-between items-center gap-4">
                        <h3 class="font-bold text-lg text-gray-800">Recent Quote Requests</h3>
                        <div class="flex gap-2">
                            <div class="relative">
                                <!-- <input type="text" placeholder="Search..."
                                    class="pl-9 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary w-full md:w-64">
                                <i class="fa fa-search absolute left-3 top-3 text-gray-400 text-xs"></i> -->
                            </div>
                            <button onclick="exportInquiries()"
                                class="mt-4 md:mt-0 bg-primary hover:bg-red-600 text-white px-4 py-2 rounded shadow transition flex items-center">
                                <i class="fa fa-download mr-1"></i> Export
                            </button>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-gray-50 text-gray-600 text-sm uppercase tracking-wider">
                                    <th class="p-4 font-semibold border-b">ID</th>
                                    <th class="p-4 font-semibold border-b">Client</th>
                                    <th class="p-4 font-semibold border-b">Subject</th>
                                    <th class="p-4 font-semibold border-b">Message</th>
                                    <th class="p-4 font-semibold border-b">Status</th>
                                    <th class="p-4 font-semibold border-b text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="inquiry-table-body" class="text-sm text-gray-700">
                                <!-- Updated dynamically by jS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Inquiry details -->
            <div id="viewInquiryModal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="modal-title"
                role="dialog" aria-modal="true">
                <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                    <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

                    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                    <div
                        class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full">

                        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4 border-b border-gray-100">
                            <div class="sm:flex sm:items-start justify-between">
                                <div class="mt-3 text-center sm:mt-0 sm:ml-0 sm:text-left w-full">
                                    <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                                        <i class="fa fa-file-alt text-primary mr-2"></i>Inquiry Details
                                    </h3>
                                    <p class="text-sm text-gray-500 mt-1">
                                        ID: <span id="view-id" class="font-mono font-bold text-gray-700"></span>
                                    </p>
                                </div>
                                <button onclick="closeViewModal()"
                                    class="text-gray-400 hover:text-gray-600 focus:outline-none">
                                    <i class="fa fa-times text-xl"></i>
                                </button>
                            </div>
                        </div>

                        <div class="bg-white px-4 py-5 sm:p-6">
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label
                                        class="block text-xs font-medium text-gray-500 uppercase tracking-wider">Client
                                        Name</label>
                                    <div id="view-name" class="mt-1 text-sm text-gray-900 font-semibold"></div>
                                </div>
                                <div>
                                    <label
                                        class="block text-xs font-medium text-gray-500 uppercase tracking-wider">Contact</label>
                                    <div id="view-mobile" class="mt-1 text-sm text-gray-900 font-semibold"></div>
                                    <div id="view-email" class="mt-1 text-sm text-gray-900 font-semibold"></div>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label
                                    class="block text-xs font-medium text-gray-500 uppercase tracking-wider">Subject</label>
                                <div id="view-subject"
                                    class="mt-1 text-sm text-gray-900 border-l-4 border-primary pl-3 bg-gray-50 py-1">
                                </div>
                            </div>

                            <div class="mb-5">
                                <label
                                    class="block text-xs font-medium text-gray-500 uppercase tracking-wider">Message</label>
                                <div class="mt-1 p-3 bg-gray-50 rounded-md border border-gray-100 text-sm text-gray-700 whitespace-pre-wrap h-32 overflow-y-auto custom-scrollbar"
                                    id="view-message"></div>
                            </div>

                            <div
                                class="bg-gray-50 -mx-6 -mb-6 px-6 py-4 border-t border-gray-100 grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-medium text-gray-500">Current Status</label>
                                    <div id="view-status" class="mt-1"></div>
                                </div>
                                <div class="text-right">
                                    <div class="text-xs text-gray-500">Created: <span id="view-created"
                                            class="text-gray-700 font-medium"></span></div>
                                    <div class="text-xs text-gray-500">Updated: <span id="view-updated"
                                            class="text-gray-700 font-medium"></span></div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse border-t border-gray-200">

                            <button type="button" onclick="closeViewModal()"
                                class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                                Close
                            </button>
                            <button type="button" onclick="markAsResolved()"
                                class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-base text-base font-medium hover:bg-primary hover:text-white focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                                Mark As Done
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- =========================
                 TEAM MEMBERS VIEW
                 ========================= -->
            <div id="team-members-section" class="section-view">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                    <div
                        class="p-5 border-b border-gray-200 flex flex-col md:flex-row justify-between items-center gap-4">
                        <h3 class="font-bold text-lg text-gray-800">Team Member</h3>
                        <div class="flex gap-2">
                            <!-- <input type="text" placeholder="Search team members..."
                                class="px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-primary w-full md:w-48"> -->
                            <button
                                class="mt-4 md:mt-0 bg-primary hover:bg-red-600 text-white px-4 py-2 rounded shadow transition flex items-center"
                                onclick="openMemberModal()">
                                <i class="fa fa-plus mr-1"></i> Add Team Member
                            </button>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-gray-50 text-gray-600 text-sm uppercase tracking-wider">
                                    <th class="p-4 font-semibold border-b">Member Profile</th>
                                    <th class="p-4 font-semibold border-b">Contact Info</th>
                                    <th class="p-4 font-semibold border-b">Team</th>
                                    <th class="p-4 font-semibold border-b">Note</th>
                                    <th class="p-4 font-semibold border-b text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="members-table-body" class="text-sm text-gray-700">
                                <tr>
                                    <td colspan="5" class="text-center p-8 text-gray-500">
                                        <i class="fa fa-spinner fa-spin fa-2x mb-2"></i><br>Loading members...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- Add Team Member -->
            <div id="memberModal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="modal-title"
                role="dialog" aria-modal="true">
                <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">

                    <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

                    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

                    <div
                        class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl w-full">

                        <div class="bg-white px-6 pt-6 pb-4">
                            <div class="flex items-start justify-between mb-6">
                                <h3 class="text-xl font-bold text-gray-900 flex items-center" id="member-modal-title">
                                    <span class="bg-blue-100 text-primary p-2 rounded-lg mr-3">
                                        <i class="fa fa-user-plus text-lg"></i>
                                    </span>
                                    Add Team Member
                                </h3>
                                <button type="button" onclick="closeMemberModal()"
                                    class="text-gray-400 hover:text-red-500 transition-colors focus:outline-none">
                                    <i class="fa fa-times text-xl"></i>
                                </button>
                            </div>

                            <form id="memberForm">
                                <input type="hidden" id="memberId" name="id">

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                                    <div class="space-y-4">
                                        <div>
                                            <label for="memberName"
                                                class="block text-sm font-semibold text-gray-700 mb-1">Full Name <span
                                                    class="text-red-500">*</span></label>
                                            <input type="text" id="memberName" name="name" required
                                                placeholder="e.g. John Doe"
                                                class="block w-full border border-gray-300 rounded-lg shadow-sm py-2.5 px-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent sm:text-sm transition-shadow">
                                        </div>

                                        <div>
                                            <label for="memberTeam"
                                                class="block text-sm font-medium text-gray-700 mb-1">Team <span
                                                    class="text-red-500">*</span></label>
                                            <select id="memberTeam" name="team" required
                                                class="block w-full bg-white border border-gray-300 rounded-lg shadow-sm py-2.5 px-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent sm:text-sm transition-shadow">
                                                <option value="">Select Team</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label for="memberDesignation"
                                                class="block text-sm font-medium text-gray-700 mb-1">Designation</label>
                                            <input type="text" id="memberDesignation" name="designation"
                                                placeholder="e.g. Managing Director"
                                                class="block w-full border border-gray-300 rounded-lg shadow-sm py-2.5 px-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent sm:text-sm transition-shadow">
                                        </div>

                                        <div>
                                            <label for="memberContact"
                                                class="block text-sm font-medium text-gray-700 mb-1">Contact
                                                Number</label>
                                            <input type="text" id="memberContact" name="contact" placeholder="+880..."
                                                class="block w-full border border-gray-300 rounded-lg shadow-sm py-2.5 px-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent sm:text-sm transition-shadow">
                                        </div>

                                        <div>
                                            <label for="memberNote"
                                                class="block text-sm font-medium text-gray-700 mb-1">Note / Bio</label>
                                            <textarea id="memberNote" name="note" rows="3"
                                                placeholder="Short description..."
                                                class="block w-full border border-gray-300 rounded-lg shadow-sm py-2.5 px-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent sm:text-sm transition-shadow resize-none"></textarea>
                                        </div>
                                    </div>

                                    <div class="flex flex-col gap-4">

                                        <div class="flex-grow flex flex-col">
                                            <label class="block text-sm font-semibold text-gray-700 mb-1">Profile
                                                Picture</label>
                                            <label for="memberImage"
                                                class="group flex flex-col justify-center items-center flex-grow w-full bg-gray-50 rounded-xl border-2 border-gray-300 border-dashed cursor-pointer hover:bg-blue-50 hover:border-primary transition-all duration-300 relative min-h-[200px]">

                                                <div
                                                    class="flex flex-col justify-center items-center pt-5 pb-6 text-center px-4">
                                                    <div
                                                        class="bg-white p-3 rounded-full shadow-sm mb-3 group-hover:shadow-md transition-shadow">
                                                        <i id="uploadPlaceholder"
                                                            class="fa fa-cloud-upload-alt text-3xl text-gray-400 group-hover:text-primary transition-colors"></i>
                                                    </div>

                                                    <img id="previewImage" src="#" alt="Preview"
                                                        class="hidden w-32 h-32 rounded-full object-cover shadow-lg border-4 border-white mb-3">

                                                    <p class="mb-1 text-sm text-gray-600">
                                                        <span class="font-semibold text-primary">Click to upload</span>
                                                    </p>
                                                    <p class="text-xs text-gray-400">PNG, JPG: 540x540 (Max 5MB)</p>
                                                    <p id="fileNameDisplay"
                                                        class="text-xs text-green-600 mt-2 font-semibold min-h-[1rem] truncate max-w-full">
                                                    </p>
                                                </div>

                                                <input id="memberImage" name="profileImage" type="file" class="hidden"
                                                    accept="image/*">
                                            </label>
                                        </div>

                                        <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
                                            <div class="flex items-center justify-between">
                                                <div class="flex flex-col">
                                                    <span class="text-sm font-bold text-gray-900">Show On
                                                        Homepage</span>
                                                    <span class="text-xs text-gray-500 mt-0.5">Feature this member on
                                                        the main
                                                        page</span>
                                                </div>
                                                <label class="relative inline-flex items-center cursor-pointer">
                                                    <input type="checkbox" id="showOnHome" name="showOnHome" value="1"
                                                        class="sr-only peer">
                                                    <div
                                                        class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary/50 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary shadow-inner">
                                                    </div>
                                                </label>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </form>
                        </div>

                        <div class="bg-gray-50 px-6 py-4 sm:flex sm:flex-row-reverse border-t border-gray-100">
                            <button type="button" onclick="submitMemberForm()" id="btnSaveMember"
                                class="w-full inline-flex justify-center items-center rounded-lg border border-transparent shadow-sm px-5 py-2.5 bg-primary text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:ml-3 sm:w-auto sm:text-sm transition-colors">
                                <i class="fa fa-save mr-2"></i> Save Member
                            </button>
                            <button type="button" onclick="closeMemberModal()"
                                class="mt-3 w-full inline-flex justify-center items-center rounded-lg border border-gray-300 shadow-sm px-5 py-2.5 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm transition-colors">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- =========================
                 Clients VIEW
                 ========================= -->
            <div id="clients-section" class="section-view hidden">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                    <div
                        class="p-5 border-b border-gray-200 flex flex-col md:flex-row justify-between items-center gap-4">
                        <h3 class="font-bold text-lg text-gray-800">Client Management</h3>
                        <div class="flex gap-2">
                            <button
                                class="mt-4 md:mt-0 bg-primary hover:bg-red-600 text-white px-4 py-2 rounded shadow transition flex items-center"
                                onclick="openClientModal(0)">
                                <i class="fa fa-plus mr-1"></i> Add New Client
                            </button>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-gray-50 text-gray-600 text-sm uppercase tracking-wider">
                                    <th class="p-4 font-semibold border-b">Logo / ID</th>
                                    <th class="p-4 font-semibold border-b">Client Name</th>
                                    <th class="p-4 font-semibold border-b">Address</th>
                                    <th class="p-4 font-semibold border-b">Service Name</th>
                                    <th class="p-4 font-semibold border-b">Status</th>
                                    <th class="p-4 font-semibold border-b">Note</th>
                                    <th class="p-4 font-semibold border-b text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="clients-table-body" class="text-sm text-gray-700">
                                <tr>
                                    <td colspan="7" class="text-center p-8 text-gray-500">
                                        <i class="fa fa-spinner fa-spin fa-2x mb-2"></i><br>Loading clients...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="clientModal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="modal-title"
                role="dialog" aria-modal="true">
                <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                    <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"
                        onclick="closeClientModal()"></div>

                    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

                    <div
                        class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full">
                        <div class="bg-white px-4 pt-5 pb-4 sm:p-6">
                            <div class="sm:flex sm:items-start">
                                <div class="w-full">
                                    <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4" id="clientModalTitle">
                                        <i class="fa fa-users text-primary mr-2"></i>Add New Client
                                    </h3>

                                    <form id="clientForm" onsubmit="saveClient(event)">
                                        <input type="hidden" id="clientID" name="id">

                                        <div class="mb-4">
                                            <label for="clientName"
                                                class="block text-sm font-medium text-gray-700">Client
                                                Name</label>
                                            <input type="text" id="clientName" name="name" required
                                                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm">
                                        </div>

                                        <div class="mb-4">
                                            <label for="clientArea"
                                                class="block text-sm font-medium text-gray-700">Address</label>
                                            <input type="text" id="clientArea" name="area" required
                                                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm">
                                        </div>

                                        <div class="mb-4">
                                            <label for="clientServiceName"
                                                class="block text-sm font-medium text-gray-700">Service Name</label>
                                            <input type="text" id="clientServiceName" name="service_name"
                                                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm">
                                        </div>

                                        <div class="mb-4">
                                            <label for="clientStatus"
                                                class="block text-sm font-medium text-gray-700">Status</label>
                                            <select id="clientStatus" name="status"
                                                class="mt-1 block w-full bg-white border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm">
                                                <option value="">Select Status (Optional)</option>
                                                <option value="Active">Running</option>
                                                <option value="Completed">Completed</option>
                                            </select>
                                        </div>

                                        <div class="mb-4">
                                            <label for="clientNote"
                                                class="block text-sm font-medium text-gray-700">Note</label>
                                            <textarea id="clientNote" name="note" rows="3"
                                                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"></textarea>
                                        </div>

                                        <div class="mb-4">
                                            <label class="block text-sm font-medium text-gray-700">Client Logo /
                                                Image</label>
                                            <div
                                                class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md relative">
                                                <div class="space-y-1 text-center w-full flex flex-col items-center">

                                                    <i id="clientUploadPlaceholder"
                                                        class="fa fa-image text-gray-400 text-5xl mb-3"></i>

                                                    <img id="clientPreviewImage" src="#" alt="Preview"
                                                        class="hidden h-32 w-32 object-cover rounded-full border-4 border-gray-100 shadow-sm mb-3">

                                                    <div class="flex text-sm text-gray-600 justify-center">
                                                        <label for="clientImage"
                                                            class="relative cursor-pointer bg-white rounded-md font-medium text-primary hover:text-red-500 focus-within:outline-none">
                                                            <span
                                                                class="bg-secondary text-white px-4 py-1 rounded-lg">Upload
                                                                a file</span>
                                                            <input id="clientImage" name="profileImage" type="file"
                                                                class="sr-only" accept="image/*">
                                                        </label>
                                                    </div>
                                                    <p class="text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p>
                                                    <p class="text-xs text-gray-500">540px X 540px</p>
                                                    <p id="clientFileNameDisplay"
                                                        class="text-xs text-green-600 mt-2 font-semibold"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                            <button type="submit" onclick="saveClient(event)" id="btnSaveClient"
                                class="w-full inline-flex justify-center items-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary text-base font-medium text-white hover:bg-red-600 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">
                                <span id="btnSaveClientText">
                                    Save Client
                                </span>

                                <span id="clientSpinner" class="hidden ml-2">
                                    <div
                                        class="w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin">
                                    </div>
                                </span>

                            </button>
                            <button type="button" onclick="closeClientModal()"
                                class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- =========================
                 PHOTO GALLERY VIEW
                 ========================= -->
            <div id="photo-gallery-section" class="section-view">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                    <div
                        class="p-5 border-b border-gray-200 flex flex-col md:flex-row justify-between items-center gap-4">
                        <h3 class="font-bold text-lg text-gray-800">Photo Gallery</h3>
                        <div class="flex gap-2">
                            <!-- <input type="text" placeholder="Search team members..."
                                class="px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-primary w-full md:w-48"> -->
                            <button onclick="openGalleryModal()"
                                class="mt-4 md:mt-0 bg-primary hover:bg-red-600 text-white px-4 py-2 rounded shadow transition flex items-center">
                                <i class="fa-solid fa-cloud-arrow-up mr-2"></i> Upload Images
                            </button>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-gray-50 text-gray-600 text-sm uppercase tracking-wider">
                                    <th class="p-4 border-b w-32">Preview</th>
                                    <th class="p-4 border-b">Title / Caption</th>
                                    <th class="p-4 border-b text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="gallery-table-body" class="text-sm text-gray-700">
                                <!-- Dynamically updated -->
                            </tbody>
                        </table>
                    </div>
                    <!-- Loader / Empty State -->
                    <div id="gallery-loader" class="p-12 flex justify-center hidden">
                        <div class="loader"></div>
                    </div>
                    <div id="gallery-empty" class="p-12 text-center text-gray-500 hidden bg-white">
                        <i class="fa-regular fa-images text-4xl mb-3 text-gray-300"></i>
                        <p>No images found in the gallery.</p>
                    </div>
                </div>
            </div>
            <!-- GALLERY MODAL (Add/Edit) -->
            <div id="gallery-modal"
                class="fixed inset-0 z-50 bg-black bg-opacity-50 hidden flex items-center justify-center p-4">
                <div class="bg-white rounded-lg shadow-2xl w-full max-w-xl max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                        <h3 class="text-xl font-bold font-heading text-dark" id="gallery-modal-title">Upload Images</h3>
                        <button onclick="closeGalleryModal()" class="text-gray-400 hover:text-gray-600 transition">
                            <i class="fa-solid fa-times text-xl"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        <form id="gallery-form" class="space-y-4">
                            <input type="hidden" id="gallery_id" name="id">

                            <!-- Title/Caption -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Title / Caption <span
                                        class="text-gray-400 text-xs">(Optional)</span></label>
                                <input type="text" name="title" id="gallery_title"
                                    class="w-full border border-gray-300 rounded p-2 focus:ring-primary focus:border-primary"
                                    placeholder="e.g., Site Photo">
                                <p class="text-xs text-gray-500 mt-1">If uploading multiple photos, this title will
                                    apply to all of them.</p>
                            </div>

                            <!-- Image Upload (Hidden for Edit) -->
                            <div id="upload-container">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Select Photos</label>
                                <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-primary transition cursor-pointer bg-gray-50"
                                    onclick="document.getElementById('gallery_images_input').click()">
                                    <div class="space-y-1 text-center">
                                        <i class="fa-solid fa-cloud-arrow-up text-gray-400 text-3xl mb-2"></i>
                                        <div class="flex text-sm text-gray-600 justify-center">
                                            <label for="gallery_images_input"
                                                class="relative cursor-pointer bg-white rounded-md font-medium text-primary hover:text-red-500 focus-within:outline-none">
                                                <span>Click to upload</span>
                                            </label>
                                        </div>
                                        <p class="text-xs text-gray-500">PNG, JPG up to 5MB</p>
                                        <!-- 'multiple' allows selecting multiple files -->
                                        <input id="gallery_images_input" name="images" type="file" class="sr-only"
                                            multiple accept="image/*" onchange="previewGalleryImages(this)">
                                    </div>
                                </div>
                            </div>

                            <!-- Preview Container -->
                            <div id="gallery_preview_container" class="grid grid-cols-3 gap-2 mt-2"></div>

                            <!-- Existing Image (Only shown when Editing) -->
                            <div id="edit-image-preview" class="hidden text-center">
                                <img id="current_edit_img" src="" class="h-32 mx-auto rounded border">
                            </div>

                        </form>
                    </div>
                    <div class="p-6 border-t border-gray-100 bg-gray-50 flex justify-end space-x-3">
                        <button onclick="closeGalleryModal()"
                            class="px-4 py-2 bg-white border border-gray-300 rounded text-gray-700 hover:bg-gray-50 font-medium transition">Cancel</button>
                        <button onclick="handleGallerySubmit()" id="gallery-submit-btn"
                            class="px-4 py-2 bg-primary text-white rounded hover:bg-red-600 font-medium transition shadow flex items-center">
                            <span>Save</span>
                            <div id="gallery-loading-spinner"
                                class="loader ml-2 w-4 h-4 border-2 border-white border-t-transparent hidden"></div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Modal for show message to the user -->
            <div id="statusModal" class="relative z-50 hidden" aria-labelledby="modalTitle" role="dialog"
                aria-modal="true">

                <div id="modalBackdrop"
                    class="fixed inset-0 bg-gray-900 bg-opacity-50 transition-opacity duration-300 ease-out opacity-0"
                    aria-hidden="true"></div>

                <div class="fixed inset-0 z-10 overflow-y-auto">
                    <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">

                        <div id="modalPanel"
                            class="relative transform overflow-hidden bg-white text-left shadow-xl transition-all duration-300 ease-out opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95 rounded-none sm:w-full sm:max-w-md">

                            <div class="absolute right-0 top-0 pt-4 pr-4 block">
                                <button type="button" onclick="closeStatusModal()"
                                    class="rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none">
                                    <span class="sr-only">Close</span>
                                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                        stroke="currentColor" aria-hidden="true">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>

                            <div class="px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                                <div class="text-center pb-8 mt-4">
                                    <div class="mb-4">
                                        <i id="modalIcon" class="fa fa-5x"></i>
                                    </div>
                                    <h3 class="text-2xl font-semibold leading-6 text-gray-900 mb-4" id="modalTitle">
                                    </h3>
                                    <div class="mt-2">
                                        <p class="text-sm text-gray-500 mb-6" id="modalMessage"></p>
                                    </div>
                                    <button type="button" onclick="closeStatusModal()"
                                        class="inline-flex w-auto justify-center rounded bg-blue-600 px-10 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600">
                                        OK
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Footer -->
            <footer class="w-full text-center text-gray-500 text-sm pb-4 mt-8">
                &copy;
                <script>document.write(new Date().getFullYear())</script> AJFSES Admin Panel. Designed by <a
                    href="https://projuktisheba.com/" target="_blank">Projuktisheba</a>
            </footer>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/admin-modal.js"></script>
    <script src="lib/xlsx/xlsx.full.min.js"></script>
    <!-- Default script -->
    <script>
        // Set Current Date
        const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', dateOptions);

        // set user data to the top-right section
        let userData = getUser();
        if (userData) {
            document.getElementById("user-name").innerText = userData.name;
            document.getElementById("user-email").innerText = userData.email;
        }


        function openProfileViewModal() {
            // Helper to format ISO date strings (shorter, e.g., "Dec 03, 2025")
            const formatDate = (isoString) => {
                if (!isoString) return 'N/A';
                try {
                    const date = new Date(isoString);
                    // Options for human-readable date only
                    const options = { year: 'numeric', month: 'short', day: 'numeric' };
                    return date.toLocaleDateString('en-US', options);
                } catch (e) {
                    return 'Invalid Date';
                }
            };

            // --- TOP SUMMARY SECTION ---

            // 1. Name in the summary (Top Left)
            const nameEl = document.getElementById('viewProfileName');
            if (nameEl) nameEl.textContent = userData.name || 'N/A';

            // 2. Email in the summary (Top Left)
            const emailSummaryEl = document.getElementById('viewProfileEmail');
            if (emailSummaryEl) emailSummaryEl.textContent = userData.email || 'N/A';

            // // 3. Avatar Image Source
            // const avatarEl = document.getElementById('viewProfileImage');
            // // NOTE: The HTML uses src="img/user.webp", so we update it here if avatarLink is available
            // if (avatarEl) avatarEl.src = userData.avatarLink || 'img/user.webp';


            // --- DETAIL GRID SECTION ---

            // 4. Full Name Display (Inside the grid, next to status)
            const nameDisplayEl = document.getElementById('viewProfileNameDisplay');
            if (nameDisplayEl) nameDisplayEl.textContent = userData.name || 'N/A';

            // 5. Role
            const roleEl = document.getElementById('viewProfileRoleDisplay');
            if (roleEl) roleEl.textContent = userData.role || 'N/A';

            // 6. Mobile
            const mobileEl = document.getElementById('viewProfileMobile');
            if (mobileEl) mobileEl.textContent = userData.mobile || 'N/A';

            // 7. Joining Date
            const joiningDateEl = document.getElementById('viewProfileJoiningDate');
            if (joiningDateEl) joiningDateEl.textContent = formatDate(userData.joiningDate);

            // 8. Created At (Mapped to a date field)
            const createdAtEl = document.getElementById('viewProfileCreatedAt');
            if (createdAtEl) createdAtEl.textContent = formatDate(userData.createdAt);

            // 9. Last Updated (FIXED THE TYPO HERE)
            const updatedAtEl = document.getElementById('viewProfileUpdatedAt');
            if (updatedAtEl) updatedAtEl.textContent = formatDate(userData.updatedAt);

            // 10. Address (Full Width Block)
            const addressEl = document.getElementById('viewProfileAddress');
            if (addressEl) addressEl.textContent = userData.address || 'N/A';

            // --- STATUS HANDLING ---

            // 11. Handle Status 
            const statusEl = document.getElementById('viewProfileStatus');
            if (statusEl) {
                statusEl.textContent = userData.status || 'Unknown';
                // Reset classes first
                statusEl.className = 'inline-flex items-center rounded-full px-3 py-0.5 text-xs font-medium';

                if (userData.status === 'Active') {
                    statusEl.classList.add('bg-green-100', 'text-green-800');
                } else if (userData.status === 'Inactive' || userData.status === 'Suspended') {
                    statusEl.classList.add('bg-red-100', 'text-red-800');
                } else {
                    statusEl.classList.add('bg-gray-100', 'text-gray-800');
                }
            }

            // 12. Display the modal
            document.getElementById('profileViewModal').classList.remove('hidden');
        }

        function closeProfileViewModal() {
            document.getElementById('profileViewModal').classList.add('hidden');
        }

        // Sidebar Toggle for Mobile
        const btn = document.getElementById('mobile-menu-btn');
        const sidebar = document.getElementById('sidebar');

        btn.addEventListener('click', () => {
            // Tailwind toggle classes for transformation
            if (sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.remove('-translate-x-full');
            } else {
                sidebar.classList.add('-translate-x-full');
            }
        });

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', (e) => {
            if (window.innerWidth < 1024) { // Only on mobile/tablet
                if (!sidebar.contains(e.target) && !btn.contains(e.target) && !sidebar.classList.contains('-translate-x-full')) {
                    sidebar.classList.add('-translate-x-full');
                }
            }
        });

        // Profile Menu Toggle
        function toggleProfileMenu() {
            const menu = document.getElementById('profile-menu');
            menu.classList.toggle('hidden');
        }

        window.addEventListener('DOMContentLoaded', () => {
            fetchInquiries();
        });

        // Close Profile Menu when clicking outside
        window.addEventListener('click', function (e) {
            const menu = document.getElementById('profile-menu');
            const button = e.target.closest('button');
            const menuContainer = e.target.closest('#profile-menu');

            // If the click is not on the button and not inside the menu, hide it
            if (!button && !menuContainer && !menu.classList.contains('hidden')) {
                // Check if the button was the profile button (using aria logic or simple structure check)
                // The easiest way here is to ensure the click wasn't on the toggle button
                // We added onclick to the button directly, so we need to be careful.
                // Actually, checking if e.target is NOT inside the 'relative' container is safer:
                if (!e.target.closest('.relative.ml-2')) {
                    menu.classList.add('hidden');
                }
            }
        });

        // SPA Navigation Logic
        function showSection(sectionId, element) {
            // 1. Hide all sections
            document.querySelectorAll('.section-view').forEach(section => {
                section.classList.remove('active');
            });

            // 2. Determine and show the target section
            const targetId = sectionId + '-section';

            const targetSection = document.getElementById(targetId);
            if (targetSection) targetSection.classList.add('active');

            // 3. Update Titles
            const titles = {
                'inquiries': 'Inquiry Management',
                'team-members': 'Team Members',
                'photo-gallery': 'Photo Gallery',
                'clients': 'Client Management'
            };
            const descs = {
                'inquiries': "Review and manage recent quote requests.",
                'team-members': "Manage team members.",
                'photo-gallery': "Add, or remove engineering projects.",
                'clients': "Add, or remove clients.",
            };

            document.getElementById('page-title').innerText = titles[sectionId] || 'Inquiries';
            document.getElementById('page-desc').innerText = descs[sectionId] || '';

            // 4. Update Sidebar Active State
            document.querySelectorAll('.nav-item').forEach(nav => {
                nav.classList.remove('active');
            });

            if (element) {
                element.classList.add('active');
            }

            // 5. Close sidebar on mobile
            if (window.innerWidth < 1024) {
                sidebar.classList.add('-translate-x-full');
            }

            const callbacks = {
                'inquiries': fetchInquiries,
                'photo-gallery': fetchProjects,
                'team-members': fetchMembers,
                'clients': fetchClients,
            };

            const callbackFn = callbacks[sectionId];

            if (typeof callbackFn === 'function') {
                // If the callback returns a promise, handle errors
                try {
                    const maybePromise = callbackFn();
                    if (maybePromise && typeof maybePromise.then === 'function') {
                        maybePromise.catch(err => console.error('Section callback error:', err));
                    }
                } catch (err) {
                    console.error('Section callback threw:', err);
                }
            }
        }

        // --- Date Formatter ---
        function formatDateTime(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric', month: 'short', day: 'numeric',
                hour: '2-digit', minute: '2-digit'
            });
        }

        //signout handler
        function signout() {
            localStorage.clear();
            sessionStorage.clear();
            window.location.href = "signin.html"
        }


    </script>

    <!-- Reset password script -->
    <script>
        /**
         * Toggles the visibility of a password input field.
         */
        function togglePasswordVisibility(inputId, iconId) {
            const input = document.getElementById(inputId);
            const icon = document.getElementById(iconId);

            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            }
        }
        // Get the modal element once
        const resetPasswordModal = document.getElementById('resetPasswordModal');

        // 1. OPEN MODAL
        function openResetPasswordModal() {
            // Clear the form and any previous errors/alerts when opening
            document.getElementById('resetPasswordForm').reset();
            document.getElementById('passwordMatchError').classList.add('hidden');

            const alertElement = document.getElementById('resetPasswordAlert');
            alertElement.classList.add('hidden');
            alertElement.className = 'hidden mt-4 p-3 rounded-lg text-sm'; // Clear all color classes

            // Show the modal by removing 'hidden'
            resetPasswordModal.classList.remove('hidden');
        }

        // 2. CLOSE MODAL
        function closeResetPasswordModal() {
            // Hide the modal by adding 'hidden'
            resetPasswordModal.classList.add('hidden');
            // You can optionally reset the form here if not done in open, but form.reset() is recommended in open.
        }

        // 3. SUBMIT FORM (Reset Password Logic)
        async function handleResetPassword() {
            const newPasswordInput = document.getElementById('newPassword');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const passwordMatchError = document.getElementById('passwordMatchError');
            const alertElement = document.getElementById('resetPasswordAlert');

            const btn = document.getElementById('btnSavePassword');
            const btnText = document.getElementById('btnSavePasswordText');
            const spinner = document.getElementById('resetPasswordSpinner');

            const newPassword = newPasswordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            // --- Validation and UI Reset ---
            passwordMatchError.classList.add('hidden');
            alertElement.classList.add('hidden');
            alertElement.className = 'hidden mt-4 p-3 rounded-lg text-sm';
            newPasswordInput.classList.remove('border-red-500'); // Assuming you have a style for error input

            if (newPassword !== confirmPassword) {
                passwordMatchError.classList.remove('hidden');
                confirmPasswordInput.classList.add('border-red-500');
                return;
            }

            if (newPassword.length < 6) {
                alertElement.classList.remove('hidden');
                alertElement.classList.add('bg-red-100', 'text-red-700');
                alertElement.textContent = 'Password must be at least 6 characters long.';
                newPasswordInput.classList.add('border-red-500');
                return;
            }

            // --- API Call Preparation ---
            btn.disabled = true;
            btnText.innerText = "Saving...";
            spinner.classList.remove('hidden');

            try {
                const token = getToken(); // Assuming getToken() is defined globally
                if (!token) throw new Error("Admin token not found.");

                const response = await fetch(`${apiURL}/auth/admin/reset-password`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        new_password: newPassword
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alertElement.classList.remove('hidden');
                    alertElement.classList.add('bg-green-100', 'text-green-700');
                    alertElement.textContent = data.message || 'Password successfully reset!';

                    // Show status briefly, then close
                    setTimeout(() => {
                        closeResetPasswordModal();
                    }, 2000);

                } else {
                    const errorMessage = data.message || 'Failed to reset password. Please try again.';
                    alertElement.classList.remove('hidden');
                    alertElement.classList.add('bg-red-100', 'text-red-700');
                    alertElement.textContent = errorMessage;
                }

            } catch (error) {
                console.error('Password Reset Error:', error);
                alertElement.classList.remove('hidden');
                alertElement.classList.add('bg-red-100', 'text-red-700');
                alertElement.textContent = 'A network error occurred or you are not authorized.';
            } finally {
                // Re-enable button and hide spinner
                btnText.innerText = "Save New Password";
                btn.disabled = false;
                spinner.classList.add('hidden');
            }
        }
    </script>

    <!-- Inquiries script -->
    <script>
        // --- Global Variables ---
        let fetchedInquiries = []; // Store data here to access it in the modal
        const inquiryTableBody = document.getElementById('inquiry-table-body');
        const viewModal = document.getElementById('viewInquiryModal');

        // --- Fetch Inquiries ---
        async function fetchInquiries() {
            const API_URL = `${window.env.API_URL}/inquiry`;

            // Loader
            inquiryTableBody.innerHTML = `<tr><td colspan="6" class="text-center p-8 text-gray-500"><i class="fa fa-spinner fa-spin fa-2x mb-2"></i><br>Loading...</td></tr>`;

            try {
                const token = getToken();
                const response = await fetch(API_URL, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` }
                });

                const result = await response.json();

                // 1. Extract Inquiries and store globally
                // The API now returns { inquiries: [...], counts: {...} }
                fetchedInquiries = result.inquiries || [];

                // 2. Extract Counts and update UI
                const counts = result.counts || {};
                updateDashboardStats(fetchedInquiries, counts);

                renderTable(fetchedInquiries);

            } catch (error) {
                console.error('Error:', error);
                inquiryTableBody.innerHTML = `<tr><td colspan="6" class="text-center p-8 text-red-500">Failed to load data.</td></tr>`;
            }
        }

        // --- New Helper Function to Update Stats ---
        function updateDashboardStats(inquiries, counts) {
            // Update DOM elements by ID
            // Note: Keys in 'counts' match the DB values ('NEW', 'RESOLVED')

            const newCount = counts['NEW'] || 0;
            const resolvedCount = counts['RESOLVED'] || 0;
            const totalCount = inquiries.length; // Calculate total from the array length

            // Animate numbers (optional, or just set textContent)
            document.getElementById('pending-inquiries').textContent = newCount;
            document.getElementById('resolved-inquiries').textContent = resolvedCount;
            document.getElementById('total-inquiries').textContent = totalCount;
        }

        // --- Render Table ---
        function renderTable(inquiries) {
            if (inquiries.length === 0) {
                inquiryTableBody.innerHTML = `<tr><td colspan="6" class="text-center p-6 text-gray-500">No inquiries found.</td></tr>`;
                return;
            }

            let html = '';
            inquiries.forEach(item => {
                const initials = (item.name || 'U').substring(0, 2).toUpperCase();

                html += `
                    <tr class="table-row-hover border-b border-gray-100 transition">
                        <td class="p-4 text-gray-500">#${item.id}</td>
                        <td class="p-4">
                            <div class="flex items-center gap-3">
                                <div class="h-8 w-8 rounded-full bg-blue-100 text-primary flex items-center justify-center font-bold text-xs">${initials}</div>
                                <div>
                                    <div class="font-medium text-gray-900">${item.name}</div>
                                    <div class="text-xs text-gray-500">${item.mobile || ''}</div>
                                    <div class="text-xs text-gray-500">${item.email || ''}</div>
                                </div>
                            </div>
                        </td>
                        <td class="p-4 font-medium">${item.subject}</td>
                        <td class="p-4 text-gray-500 text-sm max-w-xs truncate">${item.message}</td>
                        <td class="p-4">${getStatusBadge(item.status)}</td>
                        <td class="p-4 text-center">
                            <button onclick="viewInquiry(${item.id})" class="text-gray-500 hover:text-primary mx-1"><i class="fa fa-eye"></i></button>
                            <button onclick="deleteInquiry(${item.id})" class="text-gray-500 hover:text-red-500 mx-1"><i class="fa fa-trash"></i></button>
                        </td>
                    </tr>`;
            });
            inquiryTableBody.innerHTML = html;
        }

        // --- EXPORT TO EXCEL LOGIC ---
        function exportInquiries() {
            // 1. Check if data exists
            if (!fetchedInquiries || fetchedInquiries.length === 0) {
                showStatusModal('Ops', 'No data available to export.', 'warning');
                return;
            }

            // 2. Format the data for Excel
            // We map the raw data to a cleaner format (renaming headers, formatting dates)
            const dataToExport = fetchedInquiries.map(item => ({
                "ID": item.id,
                "Client Name": item.name,
                "Contact Info": item.contact || item.email,
                "Subject": item.subject,
                "Message": item.message,
                "Status": item.status,
                "Date Received": new Date(item.created_at).toLocaleString(), // Readable Date
                "Last Updated": new Date(item.updated_at).toLocaleString()
            }));

            // 3. Create a Worksheet
            const worksheet = XLSX.utils.json_to_sheet(dataToExport);

            // Optional: Adjust column widths automatically
            const wscols = [
                { wch: 5 },  // ID
                { wch: 20 }, // Name
                { wch: 25 }, // Contact
                { wch: 20 }, // Subject
                { wch: 40 }, // Message
                { wch: 10 }, // Status
                { wch: 20 }  // Date
            ];
            worksheet['!cols'] = wscols;

            // 4. Create a Workbook and append the worksheet
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Inquiries");

            // 5. Trigger Download
            // Generates filename like: Inquiries_Export_2023-10-25.xlsx
            const fileName = `Inquiries_Export_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(workbook, fileName);
        }

        let currentInquiryId = null;
        // --- VIEW INQUIRY LOGIC (MODAL) ---
        function viewInquiry(id) {
            currentInquiryId = id;
            // 1. Find the specific object from our global array
            const inquiry = fetchedInquiries.find(item => item.id == id);

            if (!inquiry) {
                showStatusModal('Error', 'Details not found', 'error');
                return;
            }

            // 2. Populate Modal Fields
            document.getElementById('view-id').textContent = inquiry.id || 'N/A';
            document.getElementById('view-name').textContent = inquiry.name || 'N/A';
            document.getElementById('view-mobile').innerHTML = inquiry.mobile || '';
            document.getElementById('view-email').innerHTML = inquiry.email || '';
            document.getElementById('view-subject').textContent = inquiry.subject || 'No Subject';
            document.getElementById('view-message').textContent = inquiry.message || 'No message content.';

            // 3. Handle Status HTML
            document.getElementById('view-status').innerHTML = getStatusBadge(inquiry.status);

            // 4. Handle Dates
            document.getElementById('view-created').textContent = formatDateTime(inquiry.created_at);
            document.getElementById('view-updated').textContent = formatDateTime(inquiry.updated_at);

            // 5. Show Modal
            viewModal.classList.remove('hidden');
        }

        function closeViewModal() {
            viewModal.classList.add('hidden');
        }

        // --- MARK AS RESOLVED LOGIC ---
        async function markAsResolved() {
            // 1. Validation
            if (!currentInquiryId) {
                showStatusModal('Error', 'No inquiry selected', 'error');
                return;
            }

            // 2. Confirmation
            if (!confirm("Are you sure you want to mark this inquiry as resolved?")) {
                return;
            }

            const UPDATE_URL = `${window.env.API_URL}/inquiry/update-status?id=${currentInquiryId}`;
            const btn = event.target; // Reference to the clicked button
            const originalText = btn.innerText;

            try {
                // 3. UI Loading State
                btn.innerText = "Updating ";
                btn.disabled = true;

                const token = getToken();

                // 4. API Request
                // We assume your backend accepts a PUT request with the new status
                const response = await fetch(UPDATE_URL, {
                    method: 'PATCH', // or 'PATCH' depending on your Go router
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ status: 'RESOLVED' })
                });

                // 5. Handle Response
                if (response.ok) {
                    // Close the modal
                    closeViewModal();

                    // Refresh the table and stats to show the new status
                    await fetchInquiries();

                    showStatusModal('Congratulations', 'Inquiry marked as resolved successfully!', 'success');
                } else {
                    const data = await response.json();
                    showStatusModal('Error', data.message || 'Failed to update status.', 'error');
                }

            } catch (error) {
                console.error('Update Error:', error);
                showStatusModal('Error', 'Failed to update status.', 'error');
            } finally {
                // 6. Reset Button
                btn.innerText = originalText;
                btn.disabled = false;
            }
        }

        // --- DELETE INQUIRY LOGIC ---
        async function deleteInquiry(id) {
            // 1. Confirm User Action
            // using native confirm for simplicity, or you can build a custom modal like the view one
            if (!confirm('Are you sure you want to permanently delete this inquiry?')) {
                return;
            }

            const DELETE_URL = `${window.env.API_URL}/inquiry?id=${id}`;

            try {
                // 2. Get Token
                const token = getToken();

                // 3. Send API Request
                const response = await fetch(DELETE_URL, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                });

                // 4. Handle Response
                if (response.ok) {

                    //Refresh Data
                    // Reload the table to reflect changes (removes the row from UI)
                    await fetchInquiries();
                } else {
                    // Handle Server Errors
                    const data = await response.json();
                    showStatusModal('Error', data.message || 'Failed to delete inquiry. Please try again.', 'error');
                }

            } catch (error) {
                console.error('Delete Error:', error);
                showStatusModal('Error', data.message || 'Failed to delete inquiry. Please try again.', 'error');
            }
        }

        // --- Helper: Status Badge ---
        function getStatusBadge(status) {
            const s = status ? status.toLowerCase() : 'pending';
            if (s === 'completed' || s === 'resolved') return '<span class="px-2 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700">Completed</span>';
            if (s === 'progress') return '<span class="px-2 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-700">In Progress</span>';
            return '<span class="px-2 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-700">Pending</span>';
        }
    </script>

    <!-- Team Members script -->
    <script>
        const memberModal = document.getElementById('memberModal');
        let fetchedMembers = []; // Store members globally for edit access

        // 1. OPEN MODAL (Handles both Add and Edit)
        async function openMemberModal(member = null) {
            memberModal.classList.remove('hidden');

            // UI Elements
            const title = document.getElementById('member-modal-title');
            const btn = document.getElementById('btnSaveMember');
            const form = document.getElementById('memberForm');
            const idInput = document.getElementById('memberId');

            // Toggle Switch
            const showOnHomeInput = document.getElementById('showOnHome');

            // Image Elements
            const preview = document.getElementById('previewImage');
            const placeholder = document.getElementById('uploadPlaceholder');
            const fileNameDisplay = document.getElementById('fileNameDisplay');

            // Always fetch latest teams for the dropdown
            await fetchTeams();

            if (member) {
                // === EDIT MODE ===
                // Update Title
                title.innerHTML = `
                <span class="bg-blue-100 text-primary p-2 rounded-lg mr-3">
                    <i class="fa fa-user-edit text-lg"></i>
                </span>
                Edit Team Member`;

                btn.innerHTML = '<i class="fa fa-save mr-2"></i> Update Member';

                // Fill Form Inputs
                idInput.value = member.id;
                document.getElementById('memberName').value = member.name || '';
                document.getElementById('memberTeam').value = member.team_id || '';
                document.getElementById('memberDesignation').value = member.designation || '';
                document.getElementById('memberContact').value = member.contact || '';
                document.getElementById('memberNote').value = member.note || '';

                // Handle Toggle Switch (Convert 1/0/true/false to Checked state)
                showOnHomeInput.checked = (member.show_on_homepage == 1 || member.show_on_homepage === true);

                // Handle Image Preview
                if (member.image_link) {
                    preview.src = `${window.env.API_URL}/images/${member.image_link}`;
                    preview.classList.remove('hidden');
                    placeholder.classList.add('hidden');
                    fileNameDisplay.innerText = "Current: " + member.image_link;
                } else {
                    preview.classList.add('hidden');
                    placeholder.classList.remove('hidden');
                    fileNameDisplay.innerText = "No image uploaded";
                }
            } else {
                // === ADD MODE ===
                title.innerHTML = `
                <span class="bg-blue-100 text-primary p-2 rounded-lg mr-3">
                    <i class="fa fa-user-plus text-lg"></i>
                </span>
                Add Team Member`;

                btn.innerHTML = '<i class="fa fa-save mr-2"></i> Save Member';

                // Clear Form
                form.reset();
                idInput.value = '';
                showOnHomeInput.checked = false; // Default to unchecked

                // Reset Image UI
                preview.src = '#';
                preview.classList.add('hidden');
                placeholder.classList.remove('hidden');
                fileNameDisplay.innerText = '';
            }
        }

        // 2. FETCH TEAMS (Dynamic Dropdown)
        async function fetchTeams() {
            const select = document.getElementById('memberTeam');
            const API_URL = `${window.env.API_URL}/team/list`;

            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error('Failed to fetch');
                const teams = await response.json();

                let html = '<option value="">Select Team</option>';
                teams.forEach(d => {
                    html += `<option value="${d.id}">${d.title}</option>`;
                });
                select.innerHTML = html;
            } catch (error) {
                console.error("Error loading teams:", error);
                select.innerHTML = '<option value="">Error loading options</option>';
            }
        }

        // 3. HANDLE FILE SELECTION & PREVIEW
        document.getElementById('memberImage').addEventListener('change', function (event) {
            const file = event.target.files[0];
            const preview = document.getElementById('previewImage');
            const placeholder = document.getElementById('uploadPlaceholder');
            const fileNameDisplay = document.getElementById('fileNameDisplay');

            if (file) {
                fileNameDisplay.innerText = 'Selected: ' + file.name;
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                    placeholder.classList.add('hidden');
                }
                reader.readAsDataURL(file);
            }
        });

        function closeMemberModal() {
            memberModal.classList.add('hidden');
        }

        // 4. SUBMIT FORM (Create or Update)
        async function submitMemberForm() {
            const btn = document.getElementById('btnSaveMember');
            const form = document.getElementById('memberForm');
            const id = document.getElementById('memberId').value;
            const isEdit = !!id;

            let API_URL = `${window.env.API_URL}/member`;
            let method = 'POST';

            if (isEdit) {
                API_URL = `${window.env.API_URL}/member?id=${id}`;
                method = 'PUT'; // Usually POST with _method=PUT or just POST for FormData
            }

            try {
                btn.innerText = isEdit ? "Updating..." : "Saving...";
                btn.disabled = true;

                const formData = new FormData(form);

                // FIX: Manually handle the checkbox
                // If checked, send '1', else send '0'
                const showOnHomeInput = document.getElementById('showOnHome');
                formData.set('show_on_home', showOnHomeInput.checked ? '1' : '0');

                const token = getToken();

                const response = await fetch(API_URL, {
                    method: method,
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });

                if (response.ok) {
                    showStatusModal('Success', isEdit ? 'Member updated successfully' : 'Member added successfully', 'success');
                    closeMemberModal();
                    fetchMembers();
                } else {
                    const result = await response.json();
                    showStatusModal('Error', result.message || "Failed to save member.", 'error');
                }
            } catch (error) {
                console.error("Submit Error:", error);
                showStatusModal('Error', "Network error.", 'error');
            } finally {
                btn.innerHTML = isEdit ? '<i class="fa fa-save mr-2"></i> Update Member' : '<i class="fa fa-save mr-2"></i> Save Member';
                btn.disabled = false;
            }
        }

        // --- FETCH & RENDER MEMBERS ---
        async function fetchMembers() {
            const tableBody = document.getElementById('members-table-body');
            const API_URL = `${window.env.API_URL}/member/list`;

            try {
                tableBody.innerHTML = `<tr><td colspan="6" class="text-center p-8 text-gray-500"><i class="fa fa-spinner fa-spin fa-2x mb-2"></i><br>Loading...</td></tr>`;

                const token = localStorage.getItem('token') || sessionStorage.getItem('token');
                const response = await fetch(API_URL, {
                    method: 'GET',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!response.ok) throw new Error("Failed to fetch members");

                const data = await response.json();
                fetchedMembers = Array.isArray(data) ? data : (data.members || []);

                renderMembersTable(fetchedMembers);

            } catch (error) {
                console.error('Error:', error);
                tableBody.innerHTML = `<tr><td colspan="6" class="text-center p-8 text-red-500">Failed to load members.</td></tr>`;
            }
        }

        function renderMembersTable(members) {
            const tableBody = document.getElementById('members-table-body');

            if (!members || members.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="6" class="text-center p-8 text-gray-500">No team members found.</td></tr>`;
                return;
            }

            let html = '';
            members.forEach(member => {
                // Avatar
                let avatarHtml = `<div class="h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-500"><i class="fa fa-user"></i></div>`;
                if (member.image_link) {
                    avatarHtml = `<img src="${window.env.API_URL}/images/${member.image_link}" class="h-10 w-10 rounded-full object-cover border border-gray-200" alt="${member.name}">`;
                }

                // Homepage Badge Logic
                let homeBadge = '';
                if (member.show_on_homepage == 1 || member.show_on_homepage === true) {
                    homeBadge = `<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800" title="Visible on Homepage"><i class="fa fa-home mr-1"></i> Home</span>`;
                }

                html += `
                    <tr class="table-row-hover border-b border-gray-100 transition hover:bg-gray-50">
                        <td class="p-4">
                            <div class="flex items-center gap-3">
                                ${avatarHtml}
                                <div>
                                    <div class="font-medium text-gray-900 flex items-center">
                                        <strong>${member.name}</strong>
                                        ${homeBadge}
                                    </div>
                                    <div class="text-xs text-gray-500 uppercase tracking-wide"><small>${member.designation || 'N/A'}</small></div>
                                </div>
                            </div>
                        </td>
                        <td class="p-4">
                            <div class="text-gray-700"><i class="fa fa-phone text-gray-400 mr-2 text-xs"></i>${member.contact || 'N/A'}</div>
                        </td>
                        <td class="p-4">
                            <span class="px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs font-semibold">
                            ${member.team_name || 'No Team'}
                            </span>
                        </td>
                        <td class="p-4 text-gray-500 text-sm max-w-xs truncate" title="${member.note || ''}">
                            ${member.note || '-'}
                        </td>
                        <td class="p-4 text-center">
                            <button onclick="editMember(${member.id})" class="text-gray-400 hover:text-primary mx-1 transition" title="Edit">
                                <i class="fa fa-edit"></i>
                            </button>
                            <button onclick="deleteMember(${member.id})" class="text-gray-400 hover:text-red-500 mx-1 transition" title="Delete">
                                <i class="fa fa-trash"></i>
                            </button>
                        </td>
                    </tr>`;
            });
            tableBody.innerHTML = html;
        }

        // 5. HELPER: Edit Member Trigger
        function editMember(id) {
            const member = fetchedMembers.find(m => m.id === id);
            if (member) {
                openMemberModal(member);
            } else {
                showStatusModal('Error', 'Member details not found.', 'error');
            }
        }

        // --- DELETE MEMBER LOGIC ---
        async function deleteMember(id) {
            if (!confirm(`Are you sure you want to permanently delete this member?`)) {
                return;
            }
            const DELETE_URL = `${window.env.API_URL}/member?id=${id}`;
            try {
                const token = getToken();
                const response = await fetch(DELETE_URL, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    fetchMembers();
                    showStatusModal('Deleted', 'Member removed successfully.', 'success');
                } else {
                    showStatusModal('Error', 'Failed to delete member.', 'error');
                }
            } catch (error) {
                console.error('Delete Error:', error);
                showStatusModal('Error', 'Network error.', 'error');
            }
        }
    </script>


    <script>
        const clientModal = document.getElementById('clientModal');
        let fetchedClients = []; // Store clients globally to access for editing

        // 1. OPEN MODAL (Handles both Add and Edit)
        async function openClientModal(client = null) {
            clientModal.classList.remove('hidden');

            // UI Elements
            const title = document.getElementById('clientModalTitle');
            const btn = document.getElementById('btnSaveClient');
            const btnText = document.getElementById('btnSaveClientText'); // NEW
            const spinner = document.getElementById('clientSpinner');     // NEW
            const form = document.getElementById('clientForm');
            const idInput = document.getElementById('clientID');

            // Image Elements
            const preview = document.getElementById('clientPreviewImage');
            const placeholder = document.getElementById('clientUploadPlaceholder');
            const fileNameDisplay = document.getElementById('clientFileNameDisplay');

            // Reset spinner and button state
            btn.disabled = false;
            if (spinner) spinner.classList.add('hidden');


            if (client) {
                // === EDIT MODE ===
                title.innerHTML = '<i class="fa fa-users text-primary mr-2"></i>Edit Client';
                if (btnText) btnText.innerText = "Update Client"; // Use btnText to set the content

                // Fill Form
                idInput.value = client.id;
                document.getElementById('clientName').value = client.name || '';
                document.getElementById('clientArea').value = client.area || '';
                document.getElementById('clientServiceName').value = client.service_name || '';
                document.getElementById('clientServiceDate').value = '12-12-2025';
                document.getElementById('clientStatus').value = client.status || '';
                document.getElementById('clientNote').value = client.note || '';

                // Handle Image Preview
                if (client.image_link) {
                    // Ensure image path includes /clients/ if that's where they are stored
                    preview.src = `${window.env.API_URL}/images/clients/${client.image_link}`;
                    preview.classList.remove('hidden');
                    placeholder.classList.add('hidden');
                    fileNameDisplay.innerText = "Current Image: " + client.image_link;
                } else {
                    preview.classList.add('hidden');
                    placeholder.classList.remove('hidden');
                    fileNameDisplay.innerText = "No image uploaded";
                }
            } else {
                // === ADD MODE ===
                title.innerHTML = '<i class="fa fa-users text-primary mr-2"></i>Add New Client';
                if (btnText) btnText.innerText = "Save Client"; // Use btnText to set the content

                // Clear Form
                form.reset();
                idInput.value = '';

                // Reset Image
                preview.src = '#';
                preview.classList.add('hidden');
                placeholder.classList.remove('hidden');
                fileNameDisplay.innerText = '';
            }
        }

        // 2. HANDLES FILE SELECTION & PREVIEW (Adapted from Member script)
        document.getElementById('clientImage').addEventListener('change', function (event) {
            const file = event.target.files[0];
            const preview = document.getElementById('clientPreviewImage');
            const placeholder = document.getElementById('clientUploadPlaceholder');
            const fileNameDisplay = document.getElementById('clientFileNameDisplay');

            if (file) {
                fileNameDisplay.innerText = 'Selected: ' + file.name;
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                    placeholder.classList.add('hidden');
                }
                reader.readAsDataURL(file);
            } else {
                // Reset image display if file selection is cancelled
                preview.classList.add('hidden');
                placeholder.classList.remove('hidden');
                fileNameDisplay.innerText = '';
            }
        });

        function closeClientModal() {
            clientModal.classList.add('hidden');
            document.getElementById('clientForm').reset();
        }

        // 3. SUBMIT FORM (Create or Update)
        async function saveClient(event) {
            event.preventDefault(); // Prevent default form submission
            const btn = document.getElementById('btnSaveClient');
            const btnText = document.getElementById('btnSaveClientText'); // NEW
            const spinner = document.getElementById('clientSpinner');     // NEW
            const form = document.getElementById('clientForm');
            const id = document.getElementById('clientID').value;
            const isEdit = !!id; // Boolean: true if ID exists

            // Construct URL and Method based on mode
            let API_URL = `${window.env.API_URL}/client`;
            let method = 'POST';

            if (isEdit) {
                // Use query parameter as per your Go route
                API_URL = `${window.env.API_URL}/client?id=${id}`;
                method = 'PUT';
            }

            try {
                // START: Disable button and show spinner
                btn.disabled = true;
                if (btnText) btnText.innerText = isEdit ? "Updating " : "Saving ";
                if (spinner) spinner.classList.remove('hidden');

                const formData = new FormData(form);
                const token = getToken(); // Assuming getToken() is defined globally

                const response = await fetch(API_URL, {
                    method: method,
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });

                if (response.ok) {
                    showStatusModal('Success', isEdit ? 'Client updated successfully' : 'Client added successfully', 'success');
                    closeClientModal();
                    fetchClients(); // Refresh the table
                } else {
                    const result = await response.json();
                    showStatusModal('Error', result.message || "Failed to save client.", 'error');
                }
            } catch (error) {
                console.error("Submit Error:", error);
                showStatusModal('Error', "Network error.", 'error');
            } finally {
                // END: Enable button and hide spinner
                if (btnText) btnText.innerText = isEdit ? "Update Client" : "Save Client";
                btn.disabled = false;
                if (spinner) spinner.classList.add('hidden');
            }
        }

        // --- FETCH & RENDER CLIENTS (No changes needed here) ---
        async function fetchClients() {
            const tableBody = document.getElementById('clients-table-body');
            const API_URL = `${window.env.API_URL}/client`;

            try {
                tableBody.innerHTML = `<tr><td colspan="7" class="text-center p-8 text-gray-500"><i class="fa fa-spinner fa-spin fa-2x mb-2"></i><br>Loading...</td></tr>`;

                const token = getToken();
                const response = await fetch(API_URL, {
                    method: 'GET',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!response.ok) throw new Error("Failed to fetch clients");

                const data = await response.json();
                fetchedClients = Array.isArray(data) ? data : (data.clients || []);

                renderClientsTable(fetchedClients);

            } catch (error) {
                console.error('Error fetching clients:', error);
                tableBody.innerHTML = `<tr><td colspan="7" class="text-center p-8 text-red-500">Failed to load clients.</td></tr>`;
            }
        }

        function renderClientsTable(clients) {
            const tableBody = document.getElementById('clients-table-body');

            if (!clients || clients.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="7" class="text-center p-8 text-gray-500">No clients found.</td></tr>`;
                return;
            }

            let html = '';
            clients.forEach(client => {
                // Image Logic
                let avatarHtml = `<div class="h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-500"><i class="fa fa-user"></i></div>`;
                if (client.image_link) {
                    avatarHtml = `<img src="${window.env.API_URL}/images/clients/${client.image_link}" class="h-10 w-10 rounded-full object-cover border border-gray-200" alt="${client.name}">`;
                }

                // Status Badge Logic
                let statusClass = 'bg-gray-100 text-gray-600';

                if (client.status === 'Completed') {
                    statusClass = 'bg-green-100 text-green-700';
                } else {
                    client.status = 'Running'
                }

                html += `
                <tr class="table-row-hover border-b border-gray-100 transition hover:bg-gray-50">
                    <td class="p-4">
                        <div class="flex items-center gap-3">
                            ${avatarHtml}
                            <div class="font-medium text-gray-900">#${client.id}</div>
                        </div>
                    </td>
                    <td class="p-4">
                        <div class="font-medium text-gray-900">${client.name}</div>
                    </td>
                    <td class="p-4 text-gray-700">${client.area || '-'}</td>
                    <td class="p-4 text-gray-500 text-sm">
                        ${client.service_name || '-'}
                    </td>
                    <td class="p-4">
                        <span class="px-2 py-1 ${statusClass} rounded text-xs font-semibold">
                            ${client.status || "N/A"}
                        </span>
                    </td>
                    <td class="p-4 text-gray-500 text-sm max-w-xs truncate" title="${client.note || ''}">
                        ${client.note || '-'}
                    </td>
                    <td class="p-4 text-center">
                        <button onclick="editClient(${client.id})" class="text-gray-400 hover:text-primary mx-1 transition" title="Edit">
                            <i class="fa fa-edit"></i>
                        </button>
                        <button onclick="deleteClient(${client.id})" class="text-gray-400 hover:text-red-500 mx-1 transition" title="Delete">
                            <i class="fa fa-trash"></i>
                        </button>
                    </td>
                </tr>`;
            });
            tableBody.innerHTML = html;
        }

        // 4. HELPER: Edit Client Trigger
        function editClient(id) {
            // Find the client object from the global array
            const client = fetchedClients.find(c => c.id === id);
            if (client) {
                openClientModal(client);
            } else {
                showStatusModal('Error', 'Client details not found. Please try refreshing.', 'error');
            }
        }

        // --- DELETE CLIENT LOGIC (No changes needed here) ---
        async function deleteClient(id) {
            if (!confirm(`Are you sure you want to permanently delete client #${id}?`)) {
                return;
            }
            // Use query parameter as per your Go route
            const DELETE_URL = `${window.env.API_URL}/client?id=${id}`;
            try {
                const token = getToken();
                const response = await fetch(DELETE_URL, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    fetchClients();
                    showStatusModal('Deleted', 'Client removed successfully.', 'success');
                } else {
                    showStatusModal('Error', 'Failed to delete client.', 'error');
                }
            } catch (error) {
                console.error('Delete Error:', error);
                showStatusModal('Error', 'Network error.', 'error');
            }
        }
    </script>
    <!-- Gallery script -->
    <script>
        // ==========================================================
        //  FLAT GALLERY LOGIC (Table View)
        // ==========================================================
        const apiURL = `${window.env.API_URL}`;
        async function fetchProjects() {
            const loader = document.getElementById('gallery-loader');
            const tbody = document.getElementById('gallery-table-body'); // Changed to tbody
            const emptyMsg = document.getElementById('gallery-empty');

            loader.classList.remove('hidden');
            if (tbody) tbody.innerHTML = '';
            emptyMsg.classList.add('hidden');
            try {
                const res = await fetch(`${apiURL}/gallery`);
                let data = [];
                if (res.ok) {
                    const result = await res.json();
                    const rawData = Array.isArray(result) ? result : (result.data || result.gallery || []);

                    // Flatten logic
                    rawData.forEach(item => {
                        if (item.images && Array.isArray(item.images) && item.images.length > 0) {
                            item.images.forEach(imgName => {
                                data.push({
                                    id: item.id,
                                    title: item.title,
                                    image_link: imgName
                                });
                            });
                        } else {
                            data.push(item);
                        }
                    });
                }

                // Update stats if element exists
                const statEl = document.getElementById('stat-projects-count');
                if (statEl) statEl.innerText = data.length;

                renderGalleryTable(data); // Call Table Render

            } catch (err) {
                console.error(err);
                emptyMsg.classList.remove('hidden');
            } finally {
                loader.classList.add('hidden');
            }
        }

        function renderGalleryTable(data) {
            const tbody = document.getElementById('gallery-table-body');
            const emptyMsg = document.getElementById('gallery-empty');

            if (data.length === 0) {
                emptyMsg.classList.remove('hidden');
                return;
            }

            data.forEach(item => {
                const imgUrl = item.image_link ? `${apiURL}/images/gallery/${item.image_link}` : 'img/no-img.webp';
                const itemStr = encodeURIComponent(JSON.stringify(item));

                const tr = document.createElement('tr');
                tr.className = 'border-b hover:bg-gray-50 transition align-middle';
                tr.innerHTML = `
                    <td class="p-4">
                        <img src="${imgUrl}" class="h-16 w-24 object-cover rounded border shadow-sm cursor-pointer hover:scale-105 transition" onclick="window.open('${imgUrl}', '_blank')">
                    </td>
                    <td class="p-4">
                        <p class="font-bold text-dark text-base">${item.title || '<span class="text-gray-400 italic">Untitled</span>'}</p>
                        <p class="text-xs text-gray-500 mt-1">ID: ${item.id}</p>
                    </td>
                    <td class="p-4 text-right">
                        <button onclick="openGalleryModal('${itemStr}')" class="bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white p-2 rounded mr-2 transition" title="Edit Info">
                            <i class="fa-solid fa-pen-to-square"></i>
                        </button>
                        <button onclick="deleteGalleryItem(${item.id})" class="bg-red-50 text-red-600 hover:bg-red-600 hover:text-white p-2 rounded transition" title="Delete Image">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Modal Functions (Same as before, included for completeness)
        function openGalleryModal(itemStr = null) {
            const modal = document.getElementById('gallery-modal');
            const title = document.getElementById('gallery-modal-title');
            const form = document.getElementById('gallery-form');

            const uploadContainer = document.getElementById('upload-container');
            const previewContainer = document.getElementById('gallery_preview_container');
            const editPreview = document.getElementById('edit-image-preview');

            form.reset();
            previewContainer.innerHTML = '';
            modal.classList.remove('hidden');

            if (itemStr) {
                // EDIT MODE
                const item = JSON.parse(decodeURIComponent(itemStr));
                title.textContent = 'Edit Image Details';
                document.getElementById('gallery_id').value = item.id;
                document.getElementById('gallery_title').value = item.title || '';

                uploadContainer.classList.add('hidden');
                editPreview.classList.remove('hidden');

                const imgUrl = item.image_link ? `${apiURL}/images/${item.image_link}` : '';
                editPreview.innerHTML = `
                    <div class="relative inline-block mt-2">
                        <img src="${imgUrl}" class="h-32 rounded border shadow-sm object-cover">
                        <button type="button" onclick="removeEditImage()" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center shadow hover:bg-red-600 transition" title="Replace Image">
                            <i class="fa-solid fa-times text-xs"></i>
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Current Image</p>
                `;

            } else {
                // ADD MODE
                title.textContent = 'Upload New Images';
                document.getElementById('gallery_id').value = '';

                uploadContainer.classList.remove('hidden');
                editPreview.classList.add('hidden');
                editPreview.innerHTML = '';
            }
        }

        function removeEditImage() {
            document.getElementById('edit-image-preview').classList.add('hidden');
            document.getElementById('edit-image-preview').innerHTML = '';
            document.getElementById('upload-container').classList.remove('hidden');
        }

        function closeGalleryModal() {
            document.getElementById('gallery-modal').classList.add('hidden');
        }

        function previewGalleryImages(input) {
            const container = document.getElementById('gallery_preview_container');
            container.innerHTML = '';
            if (input.files) {
                Array.from(input.files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'h-20 w-full object-cover rounded border';
                        container.appendChild(img);
                    }
                    reader.readAsDataURL(file);
                });
            }
        }

        async function handleGallerySubmit() {
            const form = document.getElementById('gallery-form');
            const formData = new FormData(form);
            const id = formData.get('id');
            const btn = document.getElementById('gallery-submit-btn');
            const spinner = document.getElementById('gallery-loading-spinner');

            btn.disabled = true;
            spinner.classList.remove('hidden');

            try {
                let url = `${apiURL}/gallery`;
                if (id) {
                    url = `${apiURL}/gallery/${id}`;
                    formData.append('_method', 'PUT');
                } else {
                    const fileInput = document.getElementById('gallery_images_input');
                    if (fileInput.files.length === 0) {
                        alert("Please select at least one image.");
                        btn.disabled = false;
                        spinner.classList.add('hidden');
                        return;
                    }
                }

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${getToken()}` },
                    body: formData
                });

                if (response.ok) {
                    closeGalleryModal();
                    fetchProjects();
                    showStatusModal('Success', 'Gallery updated successfully!');
                } else {
                    const err = await response.json();
                    showStatusModal('Error', err.message || 'Failed to save', 'error');
                }
            } catch (error) {
                console.error(error);
                showStatusModal('Error', 'Network error', 'error');
            } finally {
                btn.disabled = false;
                spinner.classList.add('hidden');
            }
        }

        async function deleteGalleryItem(id) {
            if (!confirm('Are you sure you want to delete this image?')) return;

            try {
                const response = await fetch(`${apiURL}/gallery?id=${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${getToken()}` }
                });

                if (response.ok) {
                    fetchProjects();
                    showStatusModal('Deleted', 'Image removed.');
                } else {
                    showStatusModal('Error', 'Failed to delete.', 'error');
                }
            } catch (error) {
                console.error(error);
                showStatusModal('Error', 'Network error', 'error');
            }
        }
    </script>
</body>

</html>